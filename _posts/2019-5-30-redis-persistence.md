---
layout: post
title: redis持久化
categories: JavaSE
tags: redis
author: fidemyuan
---

## 什么叫持久化

将数据（如内存中的对象）保存到可永久保存的存储设备中。持久化的主要应用是将内存中的对象存储在数据库中，或者存储在磁盘文件中、 XML 数据文件中等等。

## 为什么要持久化

数据都是缓存在内存中的，当你重启系统或者关闭系统后，缓存在内存中的数据会丢失吗，为了让数据能够长期保存，就要将 Redis 放在缓存中的数据做持久化存储。

## 实现持久化的策略

### RDB

RDB持久化方式是通过快照(snapshotting)完成的，当符合一定条件时，redis会自动将内存中所有数据以二进制方式生成一份副本并存储在硬盘上。当redis重启时，并且AOF持久化未开启时，redis会读取RDB持久化生成的二进制文件(默认名称dump.rdb，可通过设置dbfilename修改)进行数据恢复，对于持久化信息可以用过命令“info Persistence”查看。<br>

优点：（1）文件备份只有一个文件，容易查找恢复；（2）灾难恢复效率高；<br>

缺点：（1）如果在定时持久化前出现宕机，数据将丢失；（2）RDB是通过fork子进程来协助完成持久化，如果数据集较大会导致服务器短时间内停止服务<br>

### AOF

当redis存储非临时数据时，为了降低redis故障而引起的数据丢失，redis提供了AOF(Append Only File)持久化，从单词意思讲，将命令追加到文件。AOF可以将Redis执行的每一条写命令追加到磁盘文件(appendonly.aof)中,在redis启动时候优先选择从AOF文件恢复数据。由于每一次的写操作，redis都会记录到文件中，所以开启AOF持久化会对性能有一定的影响，但是大部分情况下这个影响是可以接受的，我们可以使用读写速率高的硬盘提高AOF性能。与RDB持久化相比，AOF持久化数据丢失更少，其消耗内存更少。<br>


优点：数据安全性更高，可以配置同步持久化<br>

缺点：灾难恢复效率低<br>
