---
layout: post
title: Redis缓存穿透、缓存雪崩和缓存击穿
categories: JavaSE
tags: redis
author: fidemyuan
---

Redis使用中面临的典型问题

## 缓存穿透

缓存穿透，是指查询一个数据库一定不存在的数据。正常的使用缓存流程大致是，数据查询先进行缓存查询，如果key不存在或者key已经过期，再对数据库进行查询，并把查询到的对象，放进缓存。如果数据库查询对象为空，则不放进缓存。假如有恶意攻击，就可以利用这个漏洞，对数据库造成压力，甚至压垮数据库。即便是采用UUID，也是很容易找到一个不存在的KEY，进行攻击。<br>

解决方案：当有一个查询为空的请求过来， 我们也将这个请求查询的key存放到redis并设置空值， 这样再次访问时就不会去我们的数据库了， 我一般设置其过期时间较短，这样防止数据更新后无法同步到缓存。<br>

##缓存雪崩 

缓存在同一时间创建（如天猫双十一），然后设置的缓存时间是一置的， 这样到特定的时间就会出现缓存雪崩的情况， 此时若是有当访问量的操作就会造成数据库服务器的压力过大。<br>

解决方案： 我就拿电商的项目来举例吧， 我们针对不同分类的商品设置的缓存过期时间不同，然后对统一分类的商品设置（一定范围内的）随机的过期时间，这样就十分巧妙地避免了缓存的集中消失过期，在做的时候尽量注意一些细节，比如说热门商品的缓存时间可以适当长一些，而冷门商品的过期时间短一些，这样可以尽量的减少缓存服务器的压力。<br>

## 缓存击穿

缓存击穿就是假设我们有一件特别火爆的热门商品, 它每天都有大量的客户访问，大并发集中对这一个点进行访问，当这个key在失效的瞬间，持续的大并发就穿破缓存直接请求数据库，大量的访问就落到了数据库的头上。（大多数情况下这种爆款很难对数据库服务器造成压垮性的压力。达到这个级别的电商没有几家。）<br>

解决方案：我们将主打商品就是大概率会成为爆款的商品缓存时间设置为永不过期，这样就不会造成数据库的压力了， 反言之就要牺牲缓存服务器的压力了。<br>
